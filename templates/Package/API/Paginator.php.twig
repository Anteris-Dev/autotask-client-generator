<?php

namespace Anteris\Autotask\API\{{ entityName.plural }};

use Anteris\Autotask\Support\Pagination\PageEntity;
use GuzzleHttp\Client;
use GuzzleHttp\Psr7\Request;
use GuzzleHttp\Psr7\Response;

/**
 * Returns a collection with methods that help page through results.
 */
class {{ entityName.singular }}Paginator
{
    /** @var {{ entityName.singular }}Collection Collection of {{ entityName.plural|lower }}. */
    public {{ entityName.singular }}Collection $collection;

    /** @var Client Http client for retrieving pages. */
    protected Client $client;

    /** @var PageEntity Page data transfer object. */
    protected PageEntity $page;

    /**
     * Sets up the paginator.
     *
     * @param  Client      $client    Http client for retrieving pages.
     * @param  Response    $response  Response from Http client.
     *
     * @author Aidan Casey <aidan.casey@anteris.com>
     */
    public function __construct(Client $client, Request $request, Response $response)
    {
        $this->client = $client;
        $this->collection = {{ entityName.singular }}Collection::fromGuzzle(
            $request,
            $response
        );
        $this->page = PageEntity::fromGuzzle($request, $response);
    }

    /**
     * If a next page exists, returns true. Otherwise returns false.
     * @author Aidan Casey <aidan.casey@anteris.com>
     */
    public function hasNextPage(): bool
    {
        if(! $this->page->nextPageUrl) {
            return false;
        }

        return true;
    }

    /**
     * If a previous page exists, returns true. Otherwise returns false.
     * @author Aidan Casey <aidan.casey@anteris.com>
     */
    public function hasPrevPage(): bool
    {
        if (!$this->page->prevPageUrl) {
            return false;
        }

        return true;
    }

    /**
     * Retrieves and returns the next page.
     * @author Aidan Casey <aidan.casey@anteris.com>
     */
    public function nextPage(): {{ entityName.singular }}Paginator
    {
        $request  = new Request('GET', $this->page->nextPageUrl);
        $response = $this->client->send($request);

        return new static($this->client, $request, $response);
    }

    /**
     * Retrieves and returns the previous page.
     * @author Aidan Casey <aidan.casey@anteris.com>
     */
    public function prevPage (): {{ entityName.singular }}Paginator
    {
        $request  = new Request('GET', $this->page->prevPageUrl);
        $response = $this->client->send($request);

        return new static($this->client, $request, $response);
    }
}
